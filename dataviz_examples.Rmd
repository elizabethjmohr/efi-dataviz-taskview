---
title: "Data Visualization Examples"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE) # Show code and plots

# Load packages
library(tidyverse)
library(lubridate)
library(cowplot)
library(palmerpenguins)
library(ggridges)
library(GGally)
library(ggdist)
library(ggExtra)
library(viridis)
library(RColorBrewer)

# Get target data
aquatics_targets <- readr::read_csv("https://data.ecoforecast.org/targets/aquatics/aquatics-targets.csv.gz")
#terrestrial_30min_targets <- readr::read_csv("https://data.ecoforecast.org/targets/terrestrial/terrestrial_30min-targets.csv.gz", guess_max = 1e6)
terrestrial_daily_targets <- readr::read_csv("https://data.ecoforecast.org/targets/terrestrial/terrestrial_daily-targets.csv.gz", guess_max = 1e6)
pheno_targets <- readr::read_csv("https://data.ecoforecast.org/targets/phenology/phenology-targets.csv.gz")
tick_targets <- readr::read_csv("https://data.ecoforecast.org/targets/ticks/ticks-targets.csv.gz")
beetle_targets <- readr::read_csv("https://data.ecoforecast.org/targets/beetles/beetles-targets.csv.gz", guess_max = 1e6)

# Get forecasts
combined <- read_csv("https://data.ecoforecast.org/analysis/combined_forecasts_scores.csv.gz")
aquatic_temp <- combined %>% 
  filter(theme == "aquatics", target == "temperature", !team == "EFInull")
#aquatic_oxygen <- combined %>%
  #filter(theme == "aquatics", target == "oxygen", !team == "EFInull")
#terrestrial_30min <- combined %>% 
  #filter(theme == "terrestrial_30min", !team == "EFInull")
#terrestrial_daily <- combined %>% 
  #filter(theme == "terrestrial_daily", !team == "EFInull")
#pheno <- combined %>% 
  #filter(theme == "phenology", !team == "EFInull")
#ticks <- combined %>% 
  #filter(theme == "ticks", !team == "EFInull")
#beetles <- combined %>% 
  #filter(theme == "beetles", !team == "EFInull")
```

## Histogram

```{r histogram, fig.cap = "Histogram of scores for water temperature forecasts from the EFI NEON Ecological Forecasting Challenge"}

ggplot(aquatic_temp, aes(x = crps)) +
  geom_bar()+
  scale_x_binned()+
  theme_minimal_hgrid()+
  ylab("number of forecasts") + 
  xlab("continuous ranked probability score")
```
```{r histogram2D}
p <- ggplot(pheno_targets, aes(x = gcc_90, y = rcc_90)) +
  geom_hex(bins = 60)+
  geom_point(color = "transparent")+
  ylab("greenness index") + 
  xlab("redness index")+
  theme_cowplot()+
  scale_fill_viridis()+
  theme(legend.position = c(0.8, 0.8))

ggMarginal(p,type = "histogram", fill = "grey80")

```

## Density Plot

```{r density, fig.cap = "Density plot for a log-normal distribution with mean = 0 and standard deviation = 1"}
ggplot() +
  geom_area(data = tibble(x = seq(0.01, 4, 0.01), y = dlnorm(seq(0.01, 4, 0.01))), aes(x = x, y = y), fill = "#4477AA", color = "black")+
  #geom_function(data = tibble(x = c(0,3)), aes(x = x), fun = dlnorm)+
  xlim(c(0,4))+
  theme_minimal_hgrid()+
  ylab("probability density")+
  theme(axis.title.x = element_blank())
```

## Quantile Dotplots

```{r qdotplot}

```

## Boxplot 

```{r boxplot, warning=FALSE, fig.cap="Body-mass distributions for three penguin species shown as boxplots."}
ggplot(data = penguins) +
  geom_boxplot(aes(x = species, y = body_mass_g), fill = "#BBBBBB") +
  theme_minimal() +
  xlab("species") +
  ylab("body mass (g)")
```

## Violin Plot

```{r violin, warning=FALSE, fig.cap="Body-mass distributions for three penguin species shown as violin plots."}
ggplot(data = penguins) +
  geom_violin(aes(x = species, y = body_mass_g), fill = "#BBBBBB") +
  theme_cowplot() +
  xlab("species") +
  ylab("body mass (g)")
```

## Ridgeline Plot 

```{r ridgeline, warning=FALSE, fig.cap="Body-mass distributions for three penguin species shown as staggered density plots or 'ridgeline' plots."}
ggplot(data = penguins) +
  geom_density_ridges(aes(x = body_mass_g, y = species), fill = "#BBBBBB") +
  theme_minimal_grid() +
  xlab("species") +
  ylab("body mass (g)")
```

## Scatterplot

```{r scatterplot, warning=FALSE, fig.cap="Scatterplot of penguin flipper length vs. body mass."}
ggplot(data = penguins) +
  geom_point(aes(x = flipper_length_mm, y = body_mass_g)) +
  theme_minimal_grid() +
  xlab("flipper length (mm)") +
  ylab("body mass (g)")
```

## Line graph

```{r line, fig.cap="Line graph of dissolved oxygen concentrations at the Posey Creek NEON site, 2019-2020"}
aquatics_targets %>% 
  filter(year(time) <= 2020, 
         year(time) >= 2019,
         siteID == "POSE") %>%
  ggplot(aes(x = time, y = oxygen))+
  geom_line()+
  theme_minimal_grid()+
  ylab(expression(paste("dissolved oxygen (mg ", L^-1, ")")))+
  theme(axis.title.x = element_blank())
```

```{r pointline, fig.cap="Line graph with dots showing dissolved oxygen concentrations at the Posey Creek NEON site, June 2021"}
aquatics_targets %>% 
  filter(year(time) == 2021, 
         month(time) == 6,
         siteID == "POSE") %>%
  ggplot(aes(x = time, y = oxygen))+
  geom_line()+
  geom_point()+
  theme_minimal_grid()+
  ylab(expression(paste("dissolved oxygen (mg ", L^-1, ")")))+
  theme(axis.title.x = element_blank())
```

## Pairs plots and Correlograms

```{r pairs, fig.cap = "Combined scatterplot matrix and correlation matrix for three targets in the daily terrestrial forecast challenge."}
terrestrial_daily_targets %>%
  select("ecosystem exchange" = "nee", "evapotranspiration" = "le", "soil moisture" = "vswc") %>% 
  ggpairs()+
  theme_minimal_grid(font_size = 12)
```

## Barplots

```{r barplot, fig.cap="Number of penguins observed at three islands in Palmer Archipelago, Antarctica, 2007-2009."}
ggplot(data = penguins) +
  geom_bar(aes(x = island), fill = "#4477AA") +
  theme_minimal_hgrid() +
  xlab("island") +
  ylab("count")
```

## Heatmap

```{r heatmap, fig.cap = "Heatmap of beetles species richness at 7 NEON sites, summer 2020."}
beetle_targets %>%
  filter(year(time) == 2020,
         month(time) > 5,
         month(time) < 10,
         siteID %in% c("UNDE", "STEI", "SCBI", "PUUM", "DCFS", "CPER", "BLAN")) %>%
  mutate(month = month(time)) %>%
ggplot(aes(x = month, y = siteID, fill = richness)) +
  geom_tile(width = 0.95, height = 0.95) + 
  theme_cowplot()+
  scale_fill_distiller(palette = "Blues") +
  ylab("site")+
  theme(axis.line = element_blank(),
        axis.ticks = element_blank(),
        panel.background = element_rect(fill = "#D3D3D3"))
```

## Composite Plots

```{r composite}

```

```{r facet, fig.cap = "Facet-plot showing tick counts from 3 NEON sites"}
tick_targets %>% 
  filter(siteID %in% c("SERC", "SCBI", "TALL"),
         Year == 2016) %>%
  pivot_longer(cols = c("amblyomma_americanum","ixodes_scapularis"),
               names_to = "species", 
               values_to = "count") %>%
ggplot(aes(x = epiWeek, y = count, color = species)) +
  geom_point()+
  facet_wrap(vars(siteID), nrow = 3)+
  xlab("ISO week")+
  scale_color_manual(values = c("#BB5566", "#004488"))+
  theme(legend.position = "top")
```
